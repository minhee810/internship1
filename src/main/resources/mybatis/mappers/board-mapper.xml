<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.demo.mapper.BoardMapper">

	<!-- 글 목록 조회 데이터 -->
	<resultMap type="boardVO" id="boardListMap">
		<id column="board_id" property="boardId" />
		<result column="title" property="title" />
		<result column="comment" property="comment" />
		<result column="created_date" property="createdDate" />
		<result column="modified_date" property="modifiedDate" />
		<result column="comment_cnt" property="commentCnt" />

		<collection javaType="UsersVO" property="userVO">
			<id column="user_id" property="userId" />
			<result column="username" property="username" />
		</collection>

	</resultMap>

	<!-- 1대 다 : collection (한명의 유저가 작성한 글 목록) 1대 1 : association 일반 컬럼과 pk 컬럼 
		구분, pk 컬럼에는 result 아닌 id 사용 -->


	<!-- 로그인 시 사용자 정보 조회 -->
	<select id="getBoardList" resultType="boardVO">
		<![CDATA[
			SELECT *
			FROM BOARD 
			WHERE IS_DELETED = 0
		]]>
	</select>

	<!-- 게시판 글 생성 -->
	<insert id="insertBoard" parameterType="boardListDto">
	<![CDATA[
		INSERT INTO BOARD VALUES (
			BOARD_SEQ.NEXTVAL, 
			#{title}, 
			#{content}, 
			now(), 
			now(), 
			'url', 
			#{commentCnt},  
			(SELECT USER_ID 
			FROM USERS
			WHERE USERNAME = #{userId}));
	]]>
	
	</insert>




</mapper>

